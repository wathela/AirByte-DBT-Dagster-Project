<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="PEX runtime environment variables" href="api/vars.html" /><link rel="prev" title="PEX with included Python interpreter" href="scie.html" />

    <link rel="shortcut icon" href="_static/pex-icon.png"/><!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>PEX Recipes and Notes - Pex Docs (v2.20.1)</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Pex Docs (v2.20.1)</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/pex-logo-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/pex-logo-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatispex.html">What are .pex files?</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildingpex.html">Building .pex files</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildingpex.html#invoking-the-pex-utility">Invoking the <code class="docutils literal notranslate"><span class="pre">pex</span></code> utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildingpex.html#using-bdist-pex">Using <code class="docutils literal notranslate"><span class="pre">bdist_pex</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="buildingpex.html#using-pants">Using Pants</a></li>
<li class="toctree-l1"><a class="reference internal" href="scie.html">PEX with included Python interpreter</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">PEX Recipes and Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/vars.html">PEX runtime environment variables</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/pex-tool/pex/blob/main/docs/recipes.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/pex-tool/pex/edit/main/docs/recipes.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pex-recipes-and-notes">
<span id="recipes"></span><h1>PEX Recipes and Notes<a class="headerlink" href="#pex-recipes-and-notes" title="Link to this heading">¶</a></h1>
<section id="uvicorn-and-other-customizable-application-servers">
<h2>Uvicorn and other customizable application servers<a class="headerlink" href="#uvicorn-and-other-customizable-application-servers" title="Link to this heading">¶</a></h2>
<p>Often you want to run a third-party application server and have it use your code. You can always do
this by writing a shim bit of python code that starts the application server configured to use your
code. It may be simpler though to use <code class="docutils literal notranslate"><span class="pre">--inject-env</span></code> and <code class="docutils literal notranslate"><span class="pre">--inject-args</span></code> to seal this
configuration into a PEX file without needing to write a shim.</p>
<p>For example, to package up a uvicorn-powered server of your app coroutine in <code class="docutils literal notranslate"><span class="pre">example.py</span></code> that ran
on port 8888 by default you could:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pex<span class="w"> </span><span class="s2">&quot;uvicorn[standard]&quot;</span><span class="w"> </span>-c<span class="w"> </span>uvicorn<span class="w"> </span>--inject-args<span class="w"> </span><span class="s1">&#39;example:app --port 8888&#39;</span><span class="w"> </span>-oexample-app.pex
$<span class="w"> </span>./example-app.pex
INFO:<span class="w">     </span>Started<span class="w"> </span>server<span class="w"> </span>process<span class="w"> </span><span class="o">[</span><span class="m">2014</span><span class="o">]</span>
INFO:<span class="w">     </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>application<span class="w"> </span>startup.
INFO:<span class="w">     </span>ASGI<span class="w"> </span><span class="s1">&#39;lifespan&#39;</span><span class="w"> </span>protocol<span class="w"> </span>appears<span class="w"> </span>unsupported.
INFO:<span class="w">     </span>Application<span class="w"> </span>startup<span class="w"> </span>complete.
INFO:<span class="w">     </span>Uvicorn<span class="w"> </span>running<span class="w"> </span>on<span class="w"> </span>http://127.0.0.1:8888<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>CTRL+C<span class="w"> </span>to<span class="w"> </span>quit<span class="o">)</span>
^CINFO:<span class="w">     </span>Shutting<span class="w"> </span>down
INFO:<span class="w">     </span>Finished<span class="w"> </span>server<span class="w"> </span>process<span class="w"> </span><span class="o">[</span><span class="m">2014</span><span class="o">]</span>
</pre></div>
</div>
<p>You could then over-ride the port with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./example-app.pex<span class="w"> </span>--port<span class="w"> </span><span class="m">0</span>
INFO:<span class="w">     </span>Started<span class="w"> </span>server<span class="w"> </span>process<span class="w"> </span><span class="o">[</span><span class="m">2248</span><span class="o">]</span>
INFO:<span class="w">     </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>application<span class="w"> </span>startup.
INFO:<span class="w">     </span>ASGI<span class="w"> </span><span class="s1">&#39;lifespan&#39;</span><span class="w"> </span>protocol<span class="w"> </span>appears<span class="w"> </span>unsupported.
INFO:<span class="w">     </span>Application<span class="w"> </span>startup<span class="w"> </span>complete.
INFO:<span class="w">     </span>Uvicorn<span class="w"> </span>running<span class="w"> </span>on<span class="w"> </span>http://127.0.0.1:45751<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>CTRL+C<span class="w"> </span>to<span class="w"> </span>quit<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="long-running-pex-applications-and-daemons">
<h2>Long running PEX applications and daemons<a class="headerlink" href="#long-running-pex-applications-and-daemons" title="Link to this heading">¶</a></h2>
<p>If your PEXed application will run a long time, at some point you’ll likely need to debug or
otherwise inspect it using operating system tools. Unless you built your application as a
non-<code class="docutils literal notranslate"><span class="pre">--venv</span></code> <code class="docutils literal notranslate"><span class="pre">--layout</span> <span class="pre">loose</span></code> PEX, its final process information will be inscrutable in <code class="docutils literal notranslate"><span class="pre">ps</span></code>
output since all other PEX forms re-execute themselves against an installed version of themselves in
the configured <code class="docutils literal notranslate"><span class="pre">PEX_ROOT</span></code>.</p>
<p>You’ll see something like this as a result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./my.pex<span class="w"> </span>--foo<span class="w"> </span>bar<span class="w"> </span><span class="p">&amp;</span>
$<span class="w"> </span>ps<span class="w"> </span>-o<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pex
/home/jsirois/.pyenv/versions/3.10.2/bin/python3.10<span class="w"> </span>/home/jsirois/.cache/pex/unzipped_pexes/94790b07dc3768a9926dab999b41a87e399e0aa9<span class="w"> </span>--foo<span class="w"> </span>bar
</pre></div>
</div>
<p>The original PEX file is not mentioned anywhere in the <code class="docutils literal notranslate"><span class="pre">ps</span></code> output. Worse, if you have many PEX
processes it will be unclear which process corresponds to which PEX.</p>
<p>To remedy this, simply add <a class="reference external" href="https://pypi.org/project/setproctitle/">setproctitle</a> as a dependency
for your PEX. The PEX runtime will then detect the presence of <code class="docutils literal notranslate"><span class="pre">setproctitle</span></code> and alter the
process title so you see both the Python being used to run your PEX and the PEX file being run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./my.pex<span class="w"> </span>--foo<span class="w"> </span>bar<span class="w"> </span><span class="p">&amp;</span>
$<span class="w"> </span>ps<span class="w"> </span>-o<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pex
/home/jsirois/.pyenv/versions/3.10.2/bin/python3.10<span class="w"> </span>/home/jsirois/dev/pex-tool/pex/my.pex<span class="w"> </span>--foo<span class="w"> </span>bar
</pre></div>
</div>
</section>
<section id="pex-app-in-a-container">
<h2>PEX app in a container<a class="headerlink" href="#pex-app-in-a-container" title="Link to this heading">¶</a></h2>
<p>If you want to use a PEX application in a container, you can get the smallest container footprint
and the lowest latency application start-up by installing it with the <code class="docutils literal notranslate"><span class="pre">venv</span></code> Pex tool. First make
sure you build the pex with <code class="docutils literal notranslate"><span class="pre">--include-tools</span></code> (or <code class="docutils literal notranslate"><span class="pre">--venv</span></code>), and then install it in the
container like so:</p>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.10-slim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">deps</span>
<span class="k">COPY</span><span class="w"> </span>/my-app.pex<span class="w"> </span>/
<span class="k">RUN</span><span class="w"> </span><span class="nv">PEX_TOOLS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>/usr/local/bin/python3.10<span class="w"> </span>/my-app.pex<span class="w"> </span>venv<span class="w"> </span>--scope<span class="o">=</span>deps<span class="w"> </span>--compile<span class="w"> </span>/my-app

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.10-slim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">srcs</span>
<span class="k">COPY</span><span class="w"> </span>/my-app.pex<span class="w"> </span>/
<span class="k">RUN</span><span class="w"> </span><span class="nv">PEX_TOOLS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>/usr/local/bin/python3.10<span class="w"> </span>/my-app.pex<span class="w"> </span>venv<span class="w"> </span>--scope<span class="o">=</span>srcs<span class="w"> </span>--compile<span class="w"> </span>/my-app

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.10-slim</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>deps<span class="w"> </span>/my-app<span class="w"> </span>/my-app
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>srcs<span class="w"> </span>/my-app<span class="w"> </span>/my-app
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/my-app/pex&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Here, the first two <code class="docutils literal notranslate"><span class="pre">FROM</span></code> images are illustrative. The only requirement is they need to contain
the Python interpreter your app should be run with (<code class="docutils literal notranslate"><span class="pre">/usr/local/bin/python3.10</span></code> in this example).</p>
<p>The Pex <code class="docutils literal notranslate"><span class="pre">venv</span></code> tool will:</p>
<ol class="arabic simple">
<li><p>Install the PEX as a traditional venv at <code class="docutils literal notranslate"><span class="pre">/my-app</span></code> with a script at <code class="docutils literal notranslate"><span class="pre">/my-app/pex</span></code> that runs
just like the original PEX.</p></li>
<li><p>Pre-compile all PEX Python code installed in the venv.</p></li>
</ol>
<p>Notably, the PEX venv install is done using a
<a class="reference external" href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage build</a> to ensure
only the final venv remains on disk and it uses two layers to ensure changes to application code
do not lead to re-builds of lower layers. This accommodates the common case of modifying and
re-deploying first party code more often than third party dependencies.</p>
</section>
<section id="pex-aware-application">
<h2>PEX-aware application<a class="headerlink" href="#pex-aware-application" title="Link to this heading">¶</a></h2>
<p>If your code benefits from knowing whether it is running from within a PEX or not, you can inspect
the <code class="docutils literal notranslate"><span class="pre">PEX</span></code> environment variable. If it is set, it will be the absolute path of the PEX your code
is running in. Normally this will be a PEX zip file, but it could be a directory path if the PEX was
built with a <code class="docutils literal notranslate"><span class="pre">--layout</span></code> of <code class="docutils literal notranslate"><span class="pre">packed</span></code> or <code class="docutils literal notranslate"><span class="pre">loose</span></code>.</p>
</section>
<section id="gunicorn-and-pex">
<h2>Gunicorn and PEX<a class="headerlink" href="#gunicorn-and-pex" title="Link to this heading">¶</a></h2>
<p>Normally, to run a wsgi-compatible application with Gunicorn, you’d just
point Gunicorn at your application, tell Gunicorn how to run it, and you’re
ready to go - but if your application is shipping as a PEX file, you’ll have
to bundle Gunicorn as a dependency and set Gunicorn as your entry point. Gunicorn
can’t enter a PEX file to retrieve the wsgi instance, but that doesn’t prevent
the PEX from invoking Gunicorn.</p>
<p>This retains the benefit of zero <cite>pip install</cite>’s to run your service, but it
requires a bit more setup as you must ensure Gunicorn is packaged as a dependency.
The following snippets assume Flask as the wsgi framework, Django setup should be
similar:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pex<span class="w"> </span>flask<span class="w"> </span>gunicorn<span class="w"> </span>myapp<span class="w"> </span>-c<span class="w"> </span>gunicorn<span class="w"> </span>-o<span class="w"> </span>~/service.pex
</pre></div>
</div>
<p>Once your pex file is created, you need to make sure to pass your wsgi app
instance name to the CLI at runtime for Gunicorn to know how to hook into it,
configuration can be passed in the same way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>service.pex<span class="w"> </span>myapp:appinstance<span class="w"> </span>-c<span class="w"> </span>/path/to/gunicorn_config.py
</pre></div>
</div>
<p>And there you have it, a fully portable python web service.</p>
</section>
<section id="pex-and-proxy-settings">
<h2>PEX and Proxy settings<a class="headerlink" href="#pex-and-proxy-settings" title="Link to this heading">¶</a></h2>
<p>While building pex files, you may need to fetch dependencies through a proxy. The easiest way is to use pex cli with the requests extra and environment variables. Following are the steps to do just that:</p>
<ol class="arabic simple">
<li><p>Install pex with requests</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pex<span class="o">[</span>requests<span class="o">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Set the environment variables</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="c1"># Hopefully your proxy supports https! If not, you can export HTTP_PROXY:</span>
$<span class="w"> </span><span class="c1"># export HTTP_PROXY=&#39;http://user:pass@address:port&#39;</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">HTTPS_PROXY</span><span class="o">=</span><span class="s1">&#39;https://user:pass@address:port&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Now you can test by running</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pex<span class="w"> </span>-v<span class="w"> </span>pex
</pre></div>
</div>
<p>For more information on the requests module support for proxies via environment variables, see the official documentation here: <a class="reference external" href="http://docs.python-requests.org/en/master/user/advanced/#proxies">http://docs.python-requests.org/en/master/user/advanced/#proxies</a>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/vars.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">PEX runtime environment variables</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="scie.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">PEX with included Python interpreter</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Pex project contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://pypi.org/project/pex/2.20.1/" aria-label="PyPI"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
    <path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z">
    </path>
</svg>
</a>
              <a class="muted-link " href="https://github.com/pex-tool/pex/releases/download/v2.20.1/pex" aria-label="Download"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
    <path d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z">
    </path>
</svg>
</a>
              <a class="muted-link " href="https://github.com/pex-tool/pex" aria-label="Source"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
    <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
    </path>
</svg>
</a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PEX Recipes and Notes</a><ul>
<li><a class="reference internal" href="#uvicorn-and-other-customizable-application-servers">Uvicorn and other customizable application servers</a></li>
<li><a class="reference internal" href="#long-running-pex-applications-and-daemons">Long running PEX applications and daemons</a></li>
<li><a class="reference internal" href="#pex-app-in-a-container">PEX app in a container</a></li>
<li><a class="reference internal" href="#pex-aware-application">PEX-aware application</a></li>
<li><a class="reference internal" href="#gunicorn-and-pex">Gunicorn and PEX</a></li>
<li><a class="reference internal" href="#pex-and-proxy-settings">PEX and Proxy settings</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=f4a0ca01"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>