"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1069],{51069:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return eL},default:function(){return eV}});var i=t(73235),o=t(52322),s=t(14934),r=t(74580),l=t(35292),a=t(74188),c=t(43212),u=t(37483),d=t(2784),p=t(7267),x=t(47933),m=t(40250),h=t(43111),g=t(35002),j=t(38491),y=t(56619),f=t(89776),v=t(39013),S=t(35505),w=t(50798),b=t(22351),C=t(16744),I=t(17650),N=t(83846),O=t(51154),T=t(68300),k=t(878),R=t(6484),E=t(8068),_=t(98832),A=t(23399),F=t(44900),D=t(13549),L=t(51701),V=t(88257),z=t(20171);let K=e=>{(0,d.useEffect)(()=>{let n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(!n)return;let t=n.getAttribute("href");return n.setAttribute("href",e),()=>{t&&n.setAttribute("href",t)}},[e])};var U=t(4378),J=t(34219);let q=e=>{switch(e){case V.VOA.FAILURE:return"/favicon-run-failed.svg";case V.VOA.SUCCESS:return"/favicon-run-success.svg";case V.VOA.STARTING:case V.VOA.STARTED:case V.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},P=(0,d.memo)(e=>{let{run:n,runId:t}=e,[i,s]=(0,R.Bz)(),[r,l]=(0,U.q)({queryKey:"selection",defaults:{selection:""}});K(n?q(n.status):"/favicon.svg"),(0,z.j)(n?"".concat((0,F.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));let a=(e,n)=>{let t=n.find(n=>"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e);t&&(0,E._K)({body:(0,o.jsx)(A.T9,{error:t})})},c=e=>{l(e),s({...i,logQuery:"*"!==e?[{token:"query",value:e}]:[]})},u=(0,J.FE)("RunLogs");return(0,o.jsx)(O.A.Provider,{value:n,children:(0,o.jsx)(b.C,{runId:t,children:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(M,{dependency:u}),(0,o.jsx)(T.jp,{logs:e,children:l=>(0,o.jsx)(H,{run:n,runId:t,logs:e,logsFilter:i,metadata:l,selectionQuery:r,onSetLogsFilter:s,onSetSelectionQuery:c,onShowStateDetails:a})})]})},t)})}),M=e=>{let{dependency:n}=e;return d.useLayoutEffect(()=>{n.completeDependency(J.Os.SUCCESS)},[n]),null},Q=e=>{switch(e){case"stdout":return I.hi.stdout;case"stderr":return I.hi.stderr;default:return I.hi.structured}},H=e=>{let{run:n,runId:t,logs:i,logsFilter:r,metadata:l,selectionQuery:a,onSetLogsFilter:c,onSetSelectionQuery:p}=e,[x,m]=(0,U.q)({queryKey:"logType",defaults:{logType:I.hi.structured}}),v=Q(x),[S,b]=d.useState(null),O=JSON.stringify(Object.keys(l.steps).sort()),T=d.useMemo(()=>JSON.parse(O),[O]),R=(null==n?void 0:n.executionPlan)&&(0,L.J)(null==n?void 0:n.executionPlan,l.steps),E=d.useMemo(()=>R&&a&&"*"!==a?(0,_.V)(R,a).all.map(e=>e.name):[],[R,a]),{logCaptureInfo:A,computeLogFileKey:F,setComputeLogFileKey:V}=(0,k.r)({stepKeys:T,selectionStepKeys:E,metadata:l,defaultToFirstStep:!1}),z=R?r.logQuery.filter(e=>e.token&&"query"===e.token).reduce((e,n)=>(e.push(...(0,_.V)(R,n.value).all.map(e=>e.name)),e),[]):[],[K,J]=d.useState(null),q=d.useRef(null);d.useEffect(()=>{if(q.current){let e=q.current.getSize();100===e?J("top"):0===e&&J("bottom")}},[]);let P="top"===K,M="bottom"===K,H=()=>{var e;null===(e=q.current)||void 0===e||e.changeSize(50),J(null)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.O,{ref:q,axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,o.jsx)(D.Fu,{run:n}):n.executionPlan&&R?(0,o.jsx)(h.S,{region:"gantt chart",children:(0,o.jsx)(D.hj,{options:{mode:D.hS.WATERFALL_TIMED},toolbarActions:(0,o.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,o.jsx)(g.u,{content:P?"Collapse":"Expand",children:(0,o.jsx)(j.zx,{icon:(0,o.jsx)(y.JO,{name:P?"collapse_arrows":"expand_arrows"}),onClick:P?H:()=>{var e;null===(e=q.current)||void 0===e||e.changeSize(100),J("top")}})}),(0,o.jsx)(N.NX,{run:n,graph:R,metadata:l,selection:{query:a,keys:E}})]}),runId:t,graph:R,metadata:l,selection:{query:a,keys:E},onClickStep:(e,n)=>{let t;let i=E.indexOf(e),o='"'.concat(e,'"');if(n.shiftKey)t=[...E.map(e=>a.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e)],-1!==i?t.splice(i,1):t.push(o);else if(1===E.length&&-1!==i)t=[];else{t=[o];let n=(0,k.c)(l.logCaptureSteps,e);n&&V(n)}p(t.join(", ")||"*")},onSetSelection:p,focusedTime:r.focusedTime})}):(0,o.jsx)(u.t,{icon:"error",title:"Unable to build execution plan"}):(0,o.jsx)(D.ZW,{runId:t}),secondMinSize:56,second:(0,o.jsx)(h.S,{region:"logs",children:(0,o.jsxs)(G,{children:[(0,o.jsx)(I.KZ,{logType:v,onSetLogType:e=>m(I.hi[e]),filter:r,onSetFilter:c,steps:T,metadata:l,computeLogFileKey:F,onSetComputeLogKey:V,computeLogUrl:S,counts:i.counts,isSectionExpanded:M,toggleExpanded:M?H:()=>{var e;null===(e=q.current)||void 0===e||e.changeSize(0),J("bottom")}}),v!==I.hi.structured?F?(0,o.jsx)(w.h,{logKey:F?[t,"compute_logs",F]:[],logCaptureInfo:A,visibleIOType:I.hi[v],onSetDownloadUrl:b}):(0,o.jsx)(B,{type:v}):(0,o.jsx)(C.S,{logs:i,filter:r,filterStepKeys:z,filterKey:"".concat(JSON.stringify(r)),metadata:l})]})})})})},G=S.ZP.div.withConfig({componentId:"sc-6e800cb0-0"})(["display:flex;flex-direction:column;height:100%;"]),B=e=>{let{type:n}=e;return(0,o.jsx)(s.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:v.v8()},children:(0,o.jsx)(u.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})};var W=t(20958);function Z(){let e=(0,i._)(["\n  query RunAssetsQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        assets {\n          id\n          key {\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return Z=function(){return e},e}let $=e=>{let{run:n}=e,t=(0,F.pv)(n.pipelineName),{data:i,loading:s}=(0,W.aM)(Y,{variables:{runId:n.id},skip:t,fetchPolicy:"no-cache"});return s||!i||"Run"!==i.pipelineRunOrError.__typename?null:(0,o.jsx)(m.h,{useTags:!0,assetKeys:i.pipelineRunOrError.assets.map(e=>e.key)})},Y=(0,W.Ps)(Z());var X=t(93836),ee=t(34147),en=t(55010),et=t(60603),ei=t(23102),eo=t(23808),es=t(23119),er=t(74824),el=t(59351),ea=t(43984),ec=t(33182),eu=t(96569),ed=t(4128),ep=t(50309),ex=t(85227),em=t(6023),eh=t(88610),eg=t(10539);let ej=e=>{var n,t;let{run:i,isJob:s}=e,{runConfigYaml:r}=i,l=i.tags.some(e=>e.key===ea.H.RunMetrics),[a,c]=(0,d.useState)(null),{rootServerURI:u}=(0,d.useContext)(ed.I),{refetch:x}=(0,d.useContext)(ec.Lw),m=(0,ex.m)(),h=(0,p.k6)(),[f]=(0,W.Db)(em.FREE_CONCURRENCY_SLOTS_MUTATION),v=async()=>{m(r),await (0,ep.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Copied!"})},S=async()=>{var e;(null===(e=(await f({variables:{runId:i.id}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&await (0,ep.B7)({intent:"success",icon:"check_circle",message:"Freed concurrency slots"})},w=(0,eg.$y)({repositoryName:null===(n=i.repositoryOrigin)||void 0===n?void 0:n.repositoryName,repositoryLocationName:null===(t=i.repositoryOrigin)||void 0===t?void 0:t.repositoryLocationName,run:i,isJob:s});return(0,o.jsxs)("div",{children:[(0,o.jsxs)(ee.Z,{direction:"row",spacing:8,children:[w.disabledReason?(0,o.jsx)(g.u,{content:w.disabledReason,useDisabledButtonTooltipFix:!0,children:(0,o.jsx)(j.zx,{icon:(0,o.jsx)(y.JO,{name:w.icon}),disabled:!0,children:w.label})}):(0,o.jsx)(eh.A,{icon:(0,o.jsx)(y.JO,{name:w.icon}),to:w.to,children:w.label}),(0,o.jsx)(j.zx,{icon:(0,o.jsx)(y.JO,{name:"tag"}),onClick:()=>c("config"),children:"View tags and config"}),(0,o.jsx)(en.J,{position:"bottom-right",content:(0,o.jsxs)(et.v2,{children:[(0,o.jsx)(g.u,{content:"Loadable in dagster-webserver-debug",position:"left",targetTagName:"div",children:(0,o.jsx)(et.sN,{text:"Download debug file",icon:"download_for_offline",onClick:()=>window.open("".concat(u,"/download_debug/").concat(i.id))})}),i.status===V.VOA.QUEUED?(0,o.jsx)(et.sN,{tagName:"button",icon:"history_toggle_off",text:"View queue criteria",intent:"none",onClick:()=>c("queue-criteria")}):null,l&&ei.G?(0,o.jsx)(et.sN,{tagName:"button",icon:"asset_plot",text:"View container metrics",intent:"none",onClick:()=>c("metrics")}):null,i.hasConcurrencyKeySlots&&el.cv.has(i.status)?(0,o.jsx)(et.sN,{text:"Free concurrency slots",icon:"lock",onClick:S}):null,i.hasDeletePermission?(0,o.jsx)(et.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>c("delete")}):null]}),children:(0,o.jsx)(j.zx,{icon:(0,o.jsx)(y.JO,{name:"expand_more"})})})]}),(0,o.jsx)(er.U,{isOpen:"config"===a,onClose:()=>c(null),copyConfig:()=>v(),mode:i.mode,runConfigYaml:i.runConfigYaml,tags:i.tags,isJob:s}),i.status===V.VOA.QUEUED?(0,o.jsx)(es.f,{run:i,isOpen:"queue-criteria"===a,onClose:()=>c(null)}):null,l&&ei.G?(0,o.jsx)(ei.G,{runId:i.id,isOpen:"metrics"===a,onClose:()=>c(null)}):null,i.hasDeletePermission?(0,o.jsx)(eo.N,{isOpen:"delete"===a,onClose:()=>c(null),onComplete:()=>{i.repositoryOrigin?h.push((0,eg.jT)({repoName:i.repositoryOrigin.repositoryName,repoLocation:i.repositoryOrigin.repositoryLocationName,pipelineName:i.pipelineName,isJob:s,path:"/runs"})):c(null)},onTerminateInstead:()=>c("terminate"),selectedRuns:{[i.id]:i.canTerminate}}):null,i.hasTerminatePermission?(0,o.jsx)(eu.A,{isOpen:"terminate"===a,onClose:()=>c(null),onComplete:()=>{x()},selectedRuns:{[i.id]:i.canTerminate}}):null]})};var ey=t(67994),ef=t(68283),ev=t(71406),eS=t(86269);let ew=e=>{let{loading:n,run:t}=e;return(0,o.jsxs)(o.Fragment,{children:[(null==t?void 0:t.startTime)?(0,o.jsx)(en.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(s.x,{padding:16,children:(0,o.jsx)(ef.s9,{run:t,loading:n})}),children:(0,o.jsx)(c.V,{icon:"schedule",children:(0,o.jsx)(eS.v,{timestamp:t.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):t.updateTime?(0,o.jsx)(c.V,{icon:"schedule",children:(0,o.jsx)(eS.v,{timestamp:t.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)?(0,o.jsx)(en.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(s.x,{padding:16,children:(0,o.jsx)(ef.s9,{run:t,loading:n})}),children:(0,o.jsx)(c.V,{icon:"timer",children:(0,o.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==t?void 0:t.startTime)?(0,ev.R4)(((null==t?void 0:t.endTime)*1e3||Date.now())-(null==t?void 0:t.startTime)*1e3):"â€“"})})}):null]})};var eb=t(89891),eC=t(53664),eI=t(44030);let eN=e=>{let{instigationSelector:n,instigationType:t,tickId:i}=e,[r,l]=(0,d.useState)(!1),a=t===ea.H.ScheduleName?"schedule":"sensors",{name:u}=n;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.V,{icon:a,children:(0,o.jsxs)(s.x,{flex:{direction:"row"},children:[(0,o.jsx)("span",{children:"Launched by\xa0"}),(0,o.jsx)(eb.Z,{onClick:()=>l(!0),children:(0,o.jsx)("div",{style:{maxWidth:"140px"},children:(0,o.jsx)(eC.g,{text:u})})})]})}),(0,o.jsx)(eI.X,{isOpen:r,onClose:()=>l(!1),instigationSelector:n,tickId:i})]})};var eO=t(69737),eT=t(75442);let ek=new Intl.Collator(navigator.language,{sensitivity:"base"}),eR=e=>{let{assetKeys:n,evaluationId:t}=e,i=(0,d.useMemo)(()=>[...n].sort((e,n)=>ek.compare(e.path.join("/"),n.path.join("/"))),[n]);return(0,o.jsx)(en.J,{placement:"bottom",content:(0,o.jsxs)("div",{style:{width:"340px"},children:[(0,o.jsx)(s.x,{padding:{vertical:8,horizontal:12},border:"bottom",style:{fontWeight:600},children:"Auto-materialized"}),(0,o.jsx)(s.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(e=>{let n=(0,eT.p)(e,{view:"automation",evaluation:t});return(0,o.jsxs)(s.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsx)(y.JO,{name:"asset"}),(0,o.jsx)(eC.g,{text:e.path.join("/")})]}),(0,o.jsx)(x.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,o.jsx)(c.V,{icon:"auto_materialize_policy",children:"Auto-materialized"})})};var eE=t(33847),e_=t(92199),eA=t(65822),eF=t(60082);function eD(){let e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return eD=function(){return e},e}let eL=()=>{var e;(0,eO.Px)();let{runId:n}=(0,p.UO)();(0,z.j)(n?"Run ".concat(n.slice(0,8)):"Run");let{data:t,loading:i}=(0,W.aM)(eK,{variables:{runId:n}}),u=(null==t?void 0:t.pipelineRunOrError.__typename)==="Run"?t.pipelineRunOrError:null,h=null==u?void 0:u.pipelineSnapshotId,g=(0,eF.n)(u),j=(null==g?void 0:g.match)?(0,eA.kQ)(g.match.repository.name,g.match.repositoryLocation.name):null,y=(0,d.useMemo)(()=>!!(u&&g&&(0,e_.E8)(g.match,u.pipelineName)),[u,g]),f=(0,d.useMemo)(()=>(null==u?void 0:u.tags.find(e=>e.key===ea.H.AssetEvaluationID))||null,[u]),v=(0,d.useMemo)(()=>{if(j){let e=(null==u?void 0:u.tags)||[],n=e.find(e=>e.key===ea.H.TickId);if(n){let t=e.find(e=>e.key===ea.H.ScheduleName||e.key===ea.H.SensorName);if(t){let e={name:t.value,repositoryName:j.name,repositoryLocationName:j.location};return{tickId:n.value,instigationType:t.key,instigationSelector:e}}}}return null},[u,j]);return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,o.jsx)(s.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,o.jsx)(r.m,{title:(0,o.jsxs)(l.X6,{style:{display:"flex",flexDirection:"row",gap:6},children:[(0,o.jsx)(x.rU,{to:"/runs",children:"Runs"}),(0,o.jsx)("span",{children:"/"}),(0,o.jsx)("span",{style:{fontFamily:a.b.monospace},children:n.slice(0,8)})]}),tags:u?(0,o.jsxs)(s.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(0,o.jsx)(ey.KG,{status:u.status}),(0,F.pv)(u.pipelineName)?null:(0,o.jsxs)(c.V,{icon:"run",children:["Run of"," ",(0,o.jsx)(eE.h,{pipelineName:null==u?void 0:u.pipelineName,pipelineHrefContext:j||"repo-unknown",snapshotId:h,size:"small",isJob:y})]}),v?(0,o.jsx)(eN,{instigationSelector:v.instigationSelector,instigationType:v.instigationType,tickId:v.tickId}):null,(0,F.pv)(u.pipelineName)?(0,o.jsx)(m.h,{useTags:!0,assetKeys:(0,ec.Bo)(u)}):(0,o.jsx)($,{run:u}),(0,o.jsx)(m.m,{useTags:!0,assetChecks:u.assetCheckSelection}),(0,o.jsx)(ew,{run:u,loading:i}),f&&(null===(e=u.assetSelection)||void 0===e?void 0:e.length)?(0,o.jsx)(eR,{assetKeys:u.assetSelection,evaluationId:f.value}):null]}):null,right:u?(0,o.jsx)(ej,{run:u,isJob:y}):null})}),(0,o.jsx)(ez,{data:t,runId:n})]})};var eV=eL;let ez=e=>{let{data:n,runId:t}=e;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,o.jsx)(s.x,{padding:{vertical:64},children:(0,o.jsx)(u.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,o.jsx)(P,{run:n.pipelineRunOrError,runId:t}):(0,o.jsx)(P,{run:void 0,runId:t})},eK=(0,W.Ps)(eD(),X.tQ)}}]);
//# sourceMappingURL=1069.fe3ca25504ffbc43.js.map